<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="transparent" content="true">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/3.30.2/minified.js"
        integrity="sha512-u60H4fcHTGKAVICDO65xbPZn/eTY9S/VkZxMBdfwkCaStJH88PELFskcCVXpAAyVsASRhyiyjP3zEVkFd/3KEA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        function MediaMetadata(props) {
            this.title = (props || {}).title
            this.artist = (props || {}).artist
            this.album = (props || {}).album
            this.artwork = (props || {}).artwork
        }
        navigator.mediaSession = {
            _metadata: null,
            _playbackState: 'none',
            _actionHandlers: {},
            get metadata() {
                return navigator.mediaSession._metadata
            },
            set metadata(value) {
                navigator.mediaSession._metadata = value
                MediaSessionBridge.onMetadataChanged(
                    value.title,
                    value.artist,
                    value.album,
                    (value.artwork || []).find(function (artwork) {
                        return artwork.src.indexOf('https://') === 0
                    }) || null
                )
            },
            get playbackState() {
                return navigator.mediaSession._playbackState
            },
            set playbackState(value) {
                navigator.mediaSession._playbackState = value
                MediaSessionBridge.onPlaybackStateChanged(value)
            },
            setActionHandler: function (type, callback) {
                navigator.mediaSession._actionHandlers[type] = callback
                var attachedHandlerTypes = Object.keys(navigator.mediaSession._actionHandlers)
                    .filter(function (type) {
                        return !!navigator.mediaSession._actionHandlers[type]
                    })
                MediaSessionBridge.onActionHandlersChanged(JSON.stringify(attachedHandlerTypes))
            },
            setPositionState: function (args) {
                MediaSessionBridge.onPositionStateChanged(args.position, args.duration, args.playbackRate)
            }
        }
    </script>
    <script src='https://proxy.beyondwords.io/npm/@beyondwords/player@latest/dist/umd.js'></script>
    <script>
        var resizeObserver = null
        function stopResizeObserver() {
            clearInterval(resizeObserver)
        }
        function startResizeObserver() {
            // TODO @juggle/resize-observer
            stopResizeObserver()
            resizeObserver = setInterval(function () {
                PlayerViewBridge.onResize(document.documentElement.offsetWidth, document.documentElement.offsetHeight)
            }, 1000)
        }

        var player = null
        function createPlayer(settings) {
            if (settings.showUserInterface !== false) {
                startResizeObserver()
            } else {
                stopResizeObserver()
                PlayerViewBridge.onResize(0, 0)
            }

            if (player !== null) {
                player.destroy()
            }

            player = new BeyondWords.Player(Object.assign({}, settings, {
                target: document.body,
                downloadFormats: [],
                widgetStyle: 'none',
            }))
            player.addEventListener("<any>", function (event) {
                var state = getState()
                PlayerViewBridge.onEvent(JSON.stringify(event), JSON.stringify(state))
                if (event.initiatedBy === "media-session-api") {
                    updateMediaSession(event)
                }
            })
            player.addEventListener("DurationUpdated", updateMediaSession)
            player.addEventListener("PlaybackRateUpdated", updateMediaSession)
            player.addEventListener("PlaybackEnded", updateMediaSession)
            player.addEventListener("PlaybackPaused", updateMediaSession)
            player.addEventListener("PlaybackPlaying", updateMediaSession)
            player.addEventListener("PlaybackErrored", updateMediaSession)

            function updateMediaSession(event) {
                navigator.mediaSession.playbackState = player.playbackState === 'stopped' ? 'none' : player.playbackState
                navigator.mediaSession.setPositionState({
                    position: player.currentTime,
                    duration: player.duration,
                    playbackRate: player.playbackRate
                })
            }
            function getState() {
                return {
                    playerApiUrl: player.playerApiUrl,
                    projectId: player.projectId,
                    contentId: player.contentId,
                    playlistId: player.playlistId,
                    sourceId: player.sourceId,
                    sourceUrl: player.sourceUrl,
                    playlist: player.playlist,
                    showUserInterface: player.showUserInterface,
                    playerStyle: player.playerStyle,
                    playerTitle: player.playerTitle,
                    callToAction: player.callToAction,
                    skipButtonStyle: player.skipButtonStyle,
                    playlistStyle: player.playlistStyle,
                    playlistToggle: player.playlistToggle,
                    downloadFormats: player.downloadFormats,
                    mediaSession: player.mediaSession,
                    content: player.content,
                    contentIndex: player.contentIndex,
                    introsOutros: player.introsOutros,
                    introsOutrosIndex: player.introsOutrosIndex,
                    adverts: player.adverts,
                    advertIndex: player.advertIndex,
                    persistentAdImage: player.persistentAdImage,
                    persistentIndex: player.persistentIndex,
                    duration: player.duration,
                    currentTime: player.currentTime,
                    playbackState: player.playbackState,
                    playbackRate: player.playbackRate,
                    widgetStyle: player.widgetStyle,
                    widgetPosition: player.widgetPosition,
                    widgetWidth: player.widgetWidth,
                    textColor: player.textColor,
                    backgroundColor: player.backgroundColor,
                    iconColor: player.iconColor,
                    highlightColor: player.highlightColor,
                    logoIconEnabled: player.logoIconEnabled,
                    highlightSections: player.highlightSections,
                    clickableSections: player.clickableSections,
                    segmentWidgetSections: player.segmentWidgetSections,
                    segmentWidgetPosition: player.segmentWidgetPosition,
                    currentSegment: player.currentSegment,
                    hoveredSegment: player.hoveredSegment,
                    advertConsent: player.advertConsent,
                    analyticsConsent: player.analyticsConsent,
                    analyticsCustomUrl: player.analyticsCustomUrl,
                    analyticsTag: player.analyticsTag,
                    transitions: player.transitions,
                    captureErrors: player.captureErrors
                }
            }
        }
    </script>
</head>

<body style="margin: 0;"></body>

</html>